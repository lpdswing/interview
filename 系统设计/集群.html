<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.51">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="shortcut icon" href="favicon.ico"><script src="/_vercel/insights/script.js" defer></script><title>集群 | Interview Notes</title><meta name="description" content="技术面试基础知识, 算法, 网络, 操作系统, 数据库, Python">
    <link rel="modulepreload" href="/interview/assets/app.5177f3e3.js"><link rel="modulepreload" href="/interview/assets/集群.html.56d8ce1c.js"><link rel="modulepreload" href="/interview/assets/集群.html.64c1f821.js"><link rel="prefetch" href="/interview/assets/index.html.c6a3770d.js"><link rel="prefetch" href="/interview/assets/MySQL.html.88da230e.js"><link rel="prefetch" href="/interview/assets/Redis.html.7c2c1bae.js"><link rel="prefetch" href="/interview/assets/SQL练习.html.640f5cbd.js"><link rel="prefetch" href="/interview/assets/SQL语法.html.231e1acc.js"><link rel="prefetch" href="/interview/assets/数据库系统原理.html.5cce4ddd.js"><link rel="prefetch" href="/interview/assets/分布式.html.b74a3bbe.js"><link rel="prefetch" href="/interview/assets/攻击技术.html.61d396be.js"><link rel="prefetch" href="/interview/assets/消息队列.html.bc53ed40.js"><link rel="prefetch" href="/interview/assets/系统设计基础.html.1d533f83.js"><link rel="prefetch" href="/interview/assets/缓存.html.0f10010a.js"><link rel="prefetch" href="/interview/assets/Docker.html.63211cb8.js"><link rel="prefetch" href="/interview/assets/Git.html.70b7ded5.js"><link rel="prefetch" href="/interview/assets/正则表达式.html.da9ff3be.js"><link rel="prefetch" href="/interview/assets/HTTP.html.8c94c478.js"><link rel="prefetch" href="/interview/assets/Linux.html.6e8630a8.js"><link rel="prefetch" href="/interview/assets/Socket.html.6a68f31e.js"><link rel="prefetch" href="/interview/assets/面向对象思想.html.8fa5a16b.js"><link rel="prefetch" href="/interview/assets/index.html.9cb29137.js"><link rel="prefetch" href="/interview/assets/算法 - 其它.html.b2e7afe9.js"><link rel="prefetch" href="/interview/assets/算法 - 并查集.html.ddd38526.js"><link rel="prefetch" href="/interview/assets/算法 - 排序.html.fb8ec64e.js"><link rel="prefetch" href="/interview/assets/算法 - 栈和队列.html.04aadcda.js"><link rel="prefetch" href="/interview/assets/算法 - 符号表.html.a476e4f6.js"><link rel="prefetch" href="/interview/assets/算法 - 算法分析.html.b33608ae.js"><link rel="prefetch" href="/interview/assets/index.html.50572729.js"><link rel="prefetch" href="/interview/assets/Socket.html.8b3bbe23.js"><link rel="prefetch" href="/interview/assets/计算机操作系统 - 内存管理.html.b793672f.js"><link rel="prefetch" href="/interview/assets/计算机操作系统 - 概述.html.aa2e3f1d.js"><link rel="prefetch" href="/interview/assets/计算机操作系统 - 死锁.html.f9c443a1.js"><link rel="prefetch" href="/interview/assets/计算机操作系统 - 设备管理.html.6b42287e.js"><link rel="prefetch" href="/interview/assets/计算机操作系统 - 进程管理.html.1e229faf.js"><link rel="prefetch" href="/interview/assets/计算机操作系统 - 链接.html.f5ba4246.js"><link rel="prefetch" href="/interview/assets/index.html.87520f20.js"><link rel="prefetch" href="/interview/assets/计算机网络 - 传输层.html.febc3117.js"><link rel="prefetch" href="/interview/assets/计算机网络 - 应用层.html.251c6ef7.js"><link rel="prefetch" href="/interview/assets/计算机网络 - 概述.html.a4ac3363.js"><link rel="prefetch" href="/interview/assets/计算机网络 - 物理层.html.814a40ec.js"><link rel="prefetch" href="/interview/assets/计算机网络 - 网络层.html.ac092f4f.js"><link rel="prefetch" href="/interview/assets/计算机网络 - 链路层.html.08180edc.js"><link rel="prefetch" href="/interview/assets/index.html.b928470d.js"><link rel="prefetch" href="/interview/assets/设计模式  - 单例.html.0949fc12.js"><link rel="prefetch" href="/interview/assets/设计模式 - 中介者.html.edda411a.js"><link rel="prefetch" href="/interview/assets/设计模式 - 享元.html.bcc0883f.js"><link rel="prefetch" href="/interview/assets/设计模式 - 代理.html.d0f3ef9b.js"><link rel="prefetch" href="/interview/assets/设计模式 - 原型模式.html.71cf8127.js"><link rel="prefetch" href="/interview/assets/设计模式 - 命令.html.d762cafd.js"><link rel="prefetch" href="/interview/assets/设计模式 - 备忘录.html.8bb0266e.js"><link rel="prefetch" href="/interview/assets/设计模式 - 外观.html.ec75bec1.js"><link rel="prefetch" href="/interview/assets/设计模式 - 工厂方法.html.98244e69.js"><link rel="prefetch" href="/interview/assets/设计模式 - 抽象工厂.html.dbc733c6.js"><link rel="prefetch" href="/interview/assets/设计模式 - 桥接.html.c8435d55.js"><link rel="prefetch" href="/interview/assets/设计模式 - 模板方法.html.04ae9ec2.js"><link rel="prefetch" href="/interview/assets/设计模式 - 状态.html.4c6c67bd.js"><link rel="prefetch" href="/interview/assets/设计模式 - 生成器.html.69d592d5.js"><link rel="prefetch" href="/interview/assets/设计模式 - 空对象.html.e7fc13a8.js"><link rel="prefetch" href="/interview/assets/设计模式 - 策略.html.05e5f519.js"><link rel="prefetch" href="/interview/assets/设计模式 - 简单工厂.html.72e01f01.js"><link rel="prefetch" href="/interview/assets/设计模式 - 组合.html.8fea7e91.js"><link rel="prefetch" href="/interview/assets/设计模式 - 装饰.html.34050f40.js"><link rel="prefetch" href="/interview/assets/设计模式 - 观察者.html.80d625ec.js"><link rel="prefetch" href="/interview/assets/设计模式 - 解释器.html.16e0a3db.js"><link rel="prefetch" href="/interview/assets/设计模式 - 访问者.html.c572650e.js"><link rel="prefetch" href="/interview/assets/设计模式 - 责任链.html.04211247.js"><link rel="prefetch" href="/interview/assets/设计模式 - 迭代器.html.2102c01c.js"><link rel="prefetch" href="/interview/assets/设计模式 - 适配器.html.a9f03bd1.js"><link rel="prefetch" href="/interview/assets/404.html.c3e557d0.js"><link rel="prefetch" href="/interview/assets/index.html.4611d71f.js"><link rel="prefetch" href="/interview/assets/MySQL.html.b309a05c.js"><link rel="prefetch" href="/interview/assets/Redis.html.1bbe3c7d.js"><link rel="prefetch" href="/interview/assets/SQL练习.html.89f88484.js"><link rel="prefetch" href="/interview/assets/SQL语法.html.815e8e54.js"><link rel="prefetch" href="/interview/assets/数据库系统原理.html.e73fd678.js"><link rel="prefetch" href="/interview/assets/分布式.html.07947da8.js"><link rel="prefetch" href="/interview/assets/攻击技术.html.7fec0806.js"><link rel="prefetch" href="/interview/assets/消息队列.html.c93b7ec0.js"><link rel="prefetch" href="/interview/assets/系统设计基础.html.3ecb26c5.js"><link rel="prefetch" href="/interview/assets/缓存.html.be79ea9a.js"><link rel="prefetch" href="/interview/assets/Docker.html.d6eb2a5b.js"><link rel="prefetch" href="/interview/assets/Git.html.8361dc78.js"><link rel="prefetch" href="/interview/assets/正则表达式.html.b5078dee.js"><link rel="prefetch" href="/interview/assets/HTTP.html.a464df6b.js"><link rel="prefetch" href="/interview/assets/Linux.html.4a90a6aa.js"><link rel="prefetch" href="/interview/assets/Socket.html.0198ea5f.js"><link rel="prefetch" href="/interview/assets/面向对象思想.html.6687ac7f.js"><link rel="prefetch" href="/interview/assets/index.html.3d66e6cc.js"><link rel="prefetch" href="/interview/assets/算法 - 其它.html.cf895db7.js"><link rel="prefetch" href="/interview/assets/算法 - 并查集.html.febff1c7.js"><link rel="prefetch" href="/interview/assets/算法 - 排序.html.d2ff4878.js"><link rel="prefetch" href="/interview/assets/算法 - 栈和队列.html.6f514858.js"><link rel="prefetch" href="/interview/assets/算法 - 符号表.html.86d8e1a8.js"><link rel="prefetch" href="/interview/assets/算法 - 算法分析.html.676cdeec.js"><link rel="prefetch" href="/interview/assets/index.html.6999fb26.js"><link rel="prefetch" href="/interview/assets/Socket.html.ae9d6c79.js"><link rel="prefetch" href="/interview/assets/计算机操作系统 - 内存管理.html.1d2f068f.js"><link rel="prefetch" href="/interview/assets/计算机操作系统 - 概述.html.1cc7be78.js"><link rel="prefetch" href="/interview/assets/计算机操作系统 - 死锁.html.132da1b7.js"><link rel="prefetch" href="/interview/assets/计算机操作系统 - 设备管理.html.24140789.js"><link rel="prefetch" href="/interview/assets/计算机操作系统 - 进程管理.html.2f6c3af5.js"><link rel="prefetch" href="/interview/assets/计算机操作系统 - 链接.html.89badc94.js"><link rel="prefetch" href="/interview/assets/index.html.5b0dc4cd.js"><link rel="prefetch" href="/interview/assets/计算机网络 - 传输层.html.a667d652.js"><link rel="prefetch" href="/interview/assets/计算机网络 - 应用层.html.6d5317f0.js"><link rel="prefetch" href="/interview/assets/计算机网络 - 概述.html.e57333a3.js"><link rel="prefetch" href="/interview/assets/计算机网络 - 物理层.html.248521df.js"><link rel="prefetch" href="/interview/assets/计算机网络 - 网络层.html.9f6d1bde.js"><link rel="prefetch" href="/interview/assets/计算机网络 - 链路层.html.0ca1cc59.js"><link rel="prefetch" href="/interview/assets/index.html.6ef2a33e.js"><link rel="prefetch" href="/interview/assets/设计模式  - 单例.html.a42561dc.js"><link rel="prefetch" href="/interview/assets/设计模式 - 中介者.html.3916dff4.js"><link rel="prefetch" href="/interview/assets/设计模式 - 享元.html.4df094f3.js"><link rel="prefetch" href="/interview/assets/设计模式 - 代理.html.df9c820d.js"><link rel="prefetch" href="/interview/assets/设计模式 - 原型模式.html.75546b9d.js"><link rel="prefetch" href="/interview/assets/设计模式 - 命令.html.a0cc4140.js"><link rel="prefetch" href="/interview/assets/设计模式 - 备忘录.html.9ff16651.js"><link rel="prefetch" href="/interview/assets/设计模式 - 外观.html.2f0f8f61.js"><link rel="prefetch" href="/interview/assets/设计模式 - 工厂方法.html.3fde6c4a.js"><link rel="prefetch" href="/interview/assets/设计模式 - 抽象工厂.html.e13fb6b3.js"><link rel="prefetch" href="/interview/assets/设计模式 - 桥接.html.3a46b2ba.js"><link rel="prefetch" href="/interview/assets/设计模式 - 模板方法.html.4a29737a.js"><link rel="prefetch" href="/interview/assets/设计模式 - 状态.html.92345325.js"><link rel="prefetch" href="/interview/assets/设计模式 - 生成器.html.12f98b4c.js"><link rel="prefetch" href="/interview/assets/设计模式 - 空对象.html.0233b488.js"><link rel="prefetch" href="/interview/assets/设计模式 - 策略.html.83a8d8b0.js"><link rel="prefetch" href="/interview/assets/设计模式 - 简单工厂.html.b0693859.js"><link rel="prefetch" href="/interview/assets/设计模式 - 组合.html.0403d9b1.js"><link rel="prefetch" href="/interview/assets/设计模式 - 装饰.html.c56bceef.js"><link rel="prefetch" href="/interview/assets/设计模式 - 观察者.html.dc2344a6.js"><link rel="prefetch" href="/interview/assets/设计模式 - 解释器.html.a631829e.js"><link rel="prefetch" href="/interview/assets/设计模式 - 访问者.html.7a1f8194.js"><link rel="prefetch" href="/interview/assets/设计模式 - 责任链.html.c06d8a53.js"><link rel="prefetch" href="/interview/assets/设计模式 - 迭代器.html.33fd0ba9.js"><link rel="prefetch" href="/interview/assets/设计模式 - 适配器.html.8823a1c3.js"><link rel="prefetch" href="/interview/assets/404.html.aa4908c9.js">
    <link rel="stylesheet" href="/interview/assets/style.a05147f3.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/interview/" class=""><img class="logo" src="/interview/favicon.ico" alt="Interview Notes"><span class="site-name can-hide">Interview Notes</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/interview/" class="" aria-label="Home"><!--[--><!--]--> Home <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/lpdswing/interview" rel="noopener noreferrer" target="_blank" aria-label="Github"><!--[--><!--]--> Github <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><div id="docsearch-container"></div></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/interview/" class="" aria-label="Home"><!--[--><!--]--> Home <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/lpdswing/interview" rel="noopener noreferrer" target="_blank" aria-label="Github"><!--[--><!--]--> Github <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">集群 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/interview/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/%E9%9B%86%E7%BE%A4.html#一、负载均衡" class="router-link-active router-link-exact-active sidebar-item" aria-label="一、负载均衡"><!--[--><!--]--> 一、负载均衡 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/interview/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/%E9%9B%86%E7%BE%A4.html#负载均衡算法" class="router-link-active router-link-exact-active sidebar-item" aria-label="负载均衡算法"><!--[--><!--]--> 负载均衡算法 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/interview/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/%E9%9B%86%E7%BE%A4.html#转发实现" class="router-link-active router-link-exact-active sidebar-item" aria-label="转发实现"><!--[--><!--]--> 转发实现 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/interview/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/%E9%9B%86%E7%BE%A4.html#二、集群下的-session-管理" class="router-link-active router-link-exact-active sidebar-item" aria-label="二、集群下的 Session 管理"><!--[--><!--]--> 二、集群下的 Session 管理 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/interview/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/%E9%9B%86%E7%BE%A4.html#sticky-session" class="router-link-active router-link-exact-active sidebar-item" aria-label="Sticky Session"><!--[--><!--]--> Sticky Session <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/interview/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/%E9%9B%86%E7%BE%A4.html#session-replication" class="router-link-active router-link-exact-active sidebar-item" aria-label="Session Replication"><!--[--><!--]--> Session Replication <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/interview/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/%E9%9B%86%E7%BE%A4.html#session-server" class="router-link-active router-link-exact-active sidebar-item" aria-label="Session Server"><!--[--><!--]--> Session Server <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="集群" tabindex="-1"><a class="header-anchor" href="#集群" aria-hidden="true">#</a> 集群</h1><!-- GFM-TOC --><ul><li><a href="#%E9%9B%86%E7%BE%A4">集群</a><ul><li><a href="#%E4%B8%80%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1">一、负载均衡</a><ul><li><a href="#%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E7%AE%97%E6%B3%95">负载均衡算法</a><ul><li><a href="#1-%E8%BD%AE%E8%AF%A2round-robin">1. 轮询（Round Robin）</a></li><li><a href="#2-%E5%8A%A0%E6%9D%83%E8%BD%AE%E8%AF%A2weighted-round-robbin">2. 加权轮询（Weighted Round Robbin）</a></li><li><a href="#3-%E6%9C%80%E5%B0%91%E8%BF%9E%E6%8E%A5least-connections">3. 最少连接（least Connections）</a></li><li><a href="#4-%E5%8A%A0%E6%9D%83%E6%9C%80%E5%B0%91%E8%BF%9E%E6%8E%A5weighted-least-connection">4. 加权最少连接（Weighted Least Connection）</a></li><li><a href="#5-%E9%9A%8F%E6%9C%BA%E7%AE%97%E6%B3%95random">5. 随机算法（Random）</a></li><li><a href="#6-%E6%BA%90%E5%9C%B0%E5%9D%80%E5%93%88%E5%B8%8C%E6%B3%95-ip-hash">6. 源地址哈希法 (IP Hash)</a></li></ul></li><li><a href="#%E8%BD%AC%E5%8F%91%E5%AE%9E%E7%8E%B0">转发实现</a><ul><li><a href="#1-http-%E9%87%8D%E5%AE%9A%E5%90%91">1. HTTP 重定向</a></li><li><a href="#2-dns-%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90">2. DNS 域名解析</a></li><li><a href="#3-%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8">3. 反向代理服务器</a></li><li><a href="#4-%E7%BD%91%E7%BB%9C%E5%B1%82">4. 网络层</a></li><li><a href="#5-%E9%93%BE%E8%B7%AF%E5%B1%82">5. 链路层</a></li></ul></li></ul></li><li><a href="#%E4%BA%8C%E9%9B%86%E7%BE%A4%E4%B8%8B%E7%9A%84-session-%E7%AE%A1%E7%90%86">二、集群下的 Session 管理</a><ul><li><a href="#sticky-session">Sticky Session</a></li><li><a href="#session-replication">Session Replication</a></li><li><a href="#session-server">Session Server</a></li></ul></li></ul></li></ul><!-- GFM-TOC --><h2 id="一、负载均衡" tabindex="-1"><a class="header-anchor" href="#一、负载均衡" aria-hidden="true">#</a> 一、负载均衡</h2><p>集群中的应用服务器（节点）通常被设计成无状态，用户可以请求任何一个节点。</p><p>负载均衡器会根据集群中每个节点的负载情况，将用户请求转发到合适的节点上。</p><p>负载均衡器可以用来实现高可用以及伸缩性：</p><ul><li>高可用：当某个节点故障时，负载均衡器会将用户请求转发到另外的节点上，从而保证所有服务持续可用；</li><li>伸缩性：根据系统整体负载情况，可以很容易地添加或移除节点。</li></ul><p>负载均衡器运行过程包含两个部分：</p><ol><li>根据负载均衡算法得到转发的节点；</li><li>进行转发。</li></ol><h3 id="负载均衡算法" tabindex="-1"><a class="header-anchor" href="#负载均衡算法" aria-hidden="true">#</a> 负载均衡算法</h3><h4 id="_1-轮询-round-robin" tabindex="-1"><a class="header-anchor" href="#_1-轮询-round-robin" aria-hidden="true">#</a> 1. 轮询（Round Robin）</h4><p>轮询算法把每个请求轮流发送到每个服务器上。</p><p>下图中，一共有 6 个客户端产生了 6 个请求，这 6 个请求按 (1, 2, 3, 4, 5, 6) 的顺序发送。(1, 3, 5) 的请求会被发送到服务器 1，(2, 4, 6) 的请求会被发送到服务器 2。</p><div align="center"><img src="https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/9daa3616-00a4-48c4-9146-792dc8499be3.jpg" width="500px"></div><br><p>该算法比较适合每个服务器的性能差不多的场景，如果有性能存在差异的情况下，那么性能较差的服务器可能无法承担过大的负载（下图的 Server 2）。</p><div align="center"><img src="https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/bfea8772-d01b-4a51-8adc-edfd7d3dce84.jpg" width="500px"></div><br><h4 id="_2-加权轮询-weighted-round-robbin" tabindex="-1"><a class="header-anchor" href="#_2-加权轮询-weighted-round-robbin" aria-hidden="true">#</a> 2. 加权轮询（Weighted Round Robbin）</h4><p>加权轮询是在轮询的基础上，根据服务器的性能差异，为服务器赋予一定的权值，性能高的服务器分配更高的权值。</p><p>例如下图中，服务器 1 被赋予的权值为 5，服务器 2 被赋予的权值为 1，那么 (1, 2, 3, 4, 5) 请求会被发送到服务器 1，(6) 请求会被发送到服务器 2。</p><div align="center"><img src="https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/4ab87717-e264-4232-825d-8aaf08f14e8b.jpg" width="500px"></div><br><h4 id="_3-最少连接-least-connections" tabindex="-1"><a class="header-anchor" href="#_3-最少连接-least-connections" aria-hidden="true">#</a> 3. 最少连接（least Connections）</h4><p>由于每个请求的连接时间不一样，使用轮询或者加权轮询算法的话，可能会让一台服务器当前连接数过大，而另一台服务器的连接过小，造成负载不均衡。</p><p>例如下图中，(1, 3, 5) 请求会被发送到服务器 1，但是 (1, 3) 很快就断开连接，此时只有 (5) 请求连接服务器 1；(2, 4, 6) 请求被发送到服务器 2，只有 (2) 的连接断开，此时 (6, 4) 请求连接服务器 2。该系统继续运行时，服务器 2 会承担过大的负载。</p><div align="center"><img src="https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/e98deb5a-d5d4-4294-aa9b-9220d4483403.jpg" width="500px"></div><br><p>最少连接算法就是将请求发送给当前最少连接数的服务器上。</p><p>例如下图中，服务器 1 当前连接数最小，那么新到来的请求 6 就会被发送到服务器 1 上。</p><div align="center"><img src="https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/43d323ac-9f07-4e4a-a315-4eaf8c38766c.jpg" width="500px"></div><br><h4 id="_4-加权最少连接-weighted-least-connection" tabindex="-1"><a class="header-anchor" href="#_4-加权最少连接-weighted-least-connection" aria-hidden="true">#</a> 4. 加权最少连接（Weighted Least Connection）</h4><p>在最少连接的基础上，根据服务器的性能为每台服务器分配权重，再根据权重计算出每台服务器能处理的连接数。</p><h4 id="_5-随机算法-random" tabindex="-1"><a class="header-anchor" href="#_5-随机算法-random" aria-hidden="true">#</a> 5. 随机算法（Random）</h4><p>把请求随机发送到服务器上。</p><p>和轮询算法类似，该算法比较适合服务器性能差不多的场景。</p><div align="center"><img src="https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/a42ad3a7-3574-4c48-a783-ed3d08a0688a.jpg" width="500px"></div><br><h4 id="_6-源地址哈希法-ip-hash" tabindex="-1"><a class="header-anchor" href="#_6-源地址哈希法-ip-hash" aria-hidden="true">#</a> 6. 源地址哈希法 (IP Hash)</h4><p>源地址哈希通过对客户端 IP 计算哈希值之后，再对服务器数量取模得到目标服务器的序号。</p><p>可以保证同一 IP 的客户端的请求会转发到同一台服务器上，用来实现会话粘滞（Sticky Session）</p><div align="center"><img src="https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/0f399a9f-1351-4b2d-b8a4-2ebe82b1a703.jpg" width="500px"></div><br><h3 id="转发实现" tabindex="-1"><a class="header-anchor" href="#转发实现" aria-hidden="true">#</a> 转发实现</h3><h4 id="_1-http-重定向" tabindex="-1"><a class="header-anchor" href="#_1-http-重定向" aria-hidden="true">#</a> 1. HTTP 重定向</h4><p>HTTP 重定向负载均衡服务器使用某种负载均衡算法计算得到服务器的 IP 地址之后，将该地址写入 HTTP 重定向报文中，状态码为 302。客户端收到重定向报文之后，需要重新向服务器发起请求。</p><p>缺点：</p><ul><li>需要两次请求，因此访问延迟比较高；</li><li>HTTP 负载均衡器处理能力有限，会限制集群的规模。</li></ul><p>该负载均衡转发的缺点比较明显，实际场景中很少使用它。</p><div align="center"><img src="https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/02a1fbfd-7a9d-4114-95df-ca2445587a1f.jpg" width="500px"></div><br><h4 id="_2-dns-域名解析" tabindex="-1"><a class="header-anchor" href="#_2-dns-域名解析" aria-hidden="true">#</a> 2. DNS 域名解析</h4><p>在 DNS 解析域名的同时使用负载均衡算法计算服务器 IP 地址。</p><p>优点：</p><ul><li>DNS 能够根据地理位置进行域名解析，返回离用户最近的服务器 IP 地址。</li></ul><p>缺点：</p><ul><li>由于 DNS 具有多级结构，每一级的域名记录都可能被缓存，当下线一台服务器需要修改 DNS 记录时，需要过很长一段时间才能生效。</li></ul><p>大型网站基本使用了 DNS 做为第一级负载均衡手段，然后在内部使用其它方式做第二级负载均衡。也就是说，域名解析的结果为内部的负载均衡服务器 IP 地址。</p><div align="center"><img src="https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/d2c072cc-8b17-480c-813e-18cdb3b4b51f.jpg" width="500px"></div><br><h4 id="_3-反向代理服务器" tabindex="-1"><a class="header-anchor" href="#_3-反向代理服务器" aria-hidden="true">#</a> 3. 反向代理服务器</h4><p>反向代理服务器位于源服务器前面，用户的请求需要先经过反向代理服务器才能到达源服务器。反向代理可以用来进行缓存、日志记录等，同时也可以用来做为负载均衡服务器。</p><p>在这种负载均衡转发方式下，客户端不直接请求源服务器，因此源服务器不需要外部 IP 地址，而反向代理需要配置内部和外部两套 IP 地址。</p><p>优点：</p><ul><li>与其它功能集成在一起，部署简单。</li></ul><p>缺点：</p><ul><li>所有请求和响应都需要经过反向代理服务器，它可能会成为性能瓶颈。</li></ul><h4 id="_4-网络层" tabindex="-1"><a class="header-anchor" href="#_4-网络层" aria-hidden="true">#</a> 4. 网络层</h4><p>在操作系统内核进程获取网络数据包，根据负载均衡算法计算源服务器的 IP 地址，并修改请求数据包的目的 IP 地址，最后进行转发。</p><p>源服务器返回的响应也需要经过负载均衡服务器，通常是让负载均衡服务器同时作为集群的网关服务器来实现。</p><p>优点：</p><ul><li>在内核进程中进行处理，性能比较高。</li></ul><p>缺点：</p><ul><li>和反向代理一样，所有的请求和响应都经过负载均衡服务器，会成为性能瓶颈。</li></ul><h4 id="_5-链路层" tabindex="-1"><a class="header-anchor" href="#_5-链路层" aria-hidden="true">#</a> 5. 链路层</h4><p>在链路层根据负载均衡算法计算源服务器的 MAC 地址，并修改请求数据包的目的 MAC 地址，并进行转发。</p><p>通过配置源服务器的虚拟 IP 地址和负载均衡服务器的 IP 地址一致，从而不需要修改 IP 地址就可以进行转发。也正因为 IP 地址一样，所以源服务器的响应不需要转发回负载均衡服务器，可以直接转发给客户端，避免了负载均衡服务器的成为瓶颈。</p><p>这是一种三角传输模式，被称为直接路由。对于提供下载和视频服务的网站来说，直接路由避免了大量的网络传输数据经过负载均衡服务器。</p><p>这是目前大型网站使用最广负载均衡转发方式，在 Linux 平台可以使用的负载均衡服务器为 LVS（Linux Virtual Server）。</p><p>参考：</p><ul><li><a href="http://www.jscape.com/blog/load-balancing-algorithms" target="_blank" rel="noopener noreferrer">Comparing Load Balancing Algorithms<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="http://slideplayer.com/slide/6599069/#" target="_blank" rel="noopener noreferrer">Redirection and Load Balancing<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><h2 id="二、集群下的-session-管理" tabindex="-1"><a class="header-anchor" href="#二、集群下的-session-管理" aria-hidden="true">#</a> 二、集群下的 Session 管理</h2><p>一个用户的 Session 信息如果存储在一个服务器上，那么当负载均衡器把用户的下一个请求转发到另一个服务器，由于服务器没有用户的 Session 信息，那么该用户就需要重新进行登录等操作。</p><h3 id="sticky-session" tabindex="-1"><a class="header-anchor" href="#sticky-session" aria-hidden="true">#</a> Sticky Session</h3><p>需要配置负载均衡器，使得一个用户的所有请求都路由到同一个服务器，这样就可以把用户的 Session 存放在该服务器中。</p><p>缺点：</p><ul><li>当服务器宕机时，将丢失该服务器上的所有 Session。</li></ul><div align="center"><img src="https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/1623f524-b011-40c8-b83f-eab38d538f76.png" width="400px"></div><br><h3 id="session-replication" tabindex="-1"><a class="header-anchor" href="#session-replication" aria-hidden="true">#</a> Session Replication</h3><p>在服务器之间进行 Session 同步操作，每个服务器都有所有用户的 Session 信息，因此用户可以向任何一个服务器进行请求。</p><p>缺点：</p><ul><li>占用过多内存；</li><li>同步过程占用网络带宽以及服务器处理器时间。</li></ul><div align="center"><img src="https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/40c6570d-c1d7-4c38-843e-ba991b2328c2.png" width="400px"></div><br><h3 id="session-server" tabindex="-1"><a class="header-anchor" href="#session-server" aria-hidden="true">#</a> Session Server</h3><p>使用一个单独的服务器存储 Session 数据，可以使用传统的 MySQL，也使用 Redis 或者 Memcached 这种内存型数据库。</p><p>优点：</p><ul><li>为了使得大型网站具有伸缩性，集群中的应用服务器通常需要保持无状态，那么应用服务器不能存储用户的会话信息。Session Server 将用户的会话信息单独进行存储，从而保证了应用服务器的无状态。</li></ul><p>缺点：</p><ul><li>需要去实现存取 Session 的代码。</li></ul><div align="center"><img src="https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/fdc45a09-f838-4348-8959-d2c793727788.png" width="600px"></div><br><p>参考：</p><ul><li><a href="https://sivalabs.in/2018/02/session-management-using-spring-session-jdbc-datastore/" target="_blank" rel="noopener noreferrer">Session Management using Spring Session with JDBC DataStore<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul></div><!--[--><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: lpdswing@qq.com">lpdswing</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/interview/assets/app.5177f3e3.js" defer></script>
  </body>
</html>
